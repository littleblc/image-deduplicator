# 需求文档

## 简介

图片去重工具是一个命令行应用程序，用于扫描指定文件夹中的所有图片文件，识别内容相同但可能名称不同的重复图片，并提供批量删除功能。该工具通过计算文件哈希值来判断图片是否重复，确保准确性和效率。

## 术语表

- **系统 (System)**: 图片去重工具应用程序
- **用户 (User)**: 使用该工具的人员
- **目标文件夹 (Target Folder)**: 用户指定的需要扫描的文件夹路径
- **图片文件 (Image File)**: 支持的图片格式文件，包括 .jpg, .jpeg, .png, .gif, .bmp, .webp, .tiff
- **文件哈希 (File Hash)**: 通过哈希算法（SHA-256）计算的文件内容唯一标识
- **重复组 (Duplicate Group)**: 具有相同文件哈希值的一组图片文件
- **原始文件 (Original File)**: 重复组中保留的文件
- **重复文件 (Duplicate File)**: 重复组中将被删除的文件

## 需求

### 需求 1

**用户故事：** 作为用户，我希望能够指定一个文件夹路径，以便系统扫描该文件夹中的所有图片文件

#### 验收标准

1. WHEN 用户启动系统 THEN 系统 SHALL 提示用户输入目标文件夹路径
2. WHEN 用户输入文件夹路径 THEN 系统 SHALL 验证该路径是否存在且可访问
3. IF 文件夹路径不存在或不可访问 THEN 系统 SHALL 显示错误消息并要求用户重新输入
4. WHEN 文件夹路径有效 THEN 系统 SHALL 递归扫描该文件夹及其所有子文件夹
5. WHILE 扫描过程进行中 THEN 系统 SHALL 显示扫描进度信息

### 需求 2

**用户故事：** 作为用户，我希望系统能够识别所有支持的图片文件格式，以便全面检测重复图片

#### 验收标准

1. WHEN 系统扫描文件 THEN 系统 SHALL 识别扩展名为 .jpg, .jpeg, .png, .gif, .bmp, .webp, .tiff 的文件作为图片文件
2. WHEN 系统遇到非图片文件 THEN 系统 SHALL 跳过该文件并继续扫描
3. WHEN 系统识别图片文件 THEN 系统 SHALL 记录该文件的完整路径
4. WHEN 扫描完成 THEN 系统 SHALL 报告找到的图片文件总数

### 需求 3

**用户故事：** 作为用户，我希望系统通过文件内容而非文件名来判断图片是否重复，以便准确识别重命名的重复图片

#### 验收标准

1. WHEN 系统处理图片文件 THEN 系统 SHALL 计算该文件的 SHA-256 哈希值
2. WHEN 两个文件具有相同的哈希值 THEN 系统 SHALL 将它们标记为重复文件
3. WHEN 两个文件名称不同但内容相同 THEN 系统 SHALL 识别它们为重复文件
4. WHEN 系统计算哈希值 THEN 系统 SHALL 读取完整文件内容以确保准确性

### 需求 4

**用户故事：** 作为用户，我希望系统能够清晰地展示所有重复图片组，以便我了解哪些图片是重复的

#### 验收标准

1. WHEN 扫描完成 THEN 系统 SHALL 按重复组显示所有重复的图片
2. WHEN 显示重复组 THEN 系统 SHALL 为每个重复组显示组编号和该组中的文件数量
3. WHEN 显示重复组中的文件 THEN 系统 SHALL 显示每个文件的完整路径和文件大小
4. WHEN 没有发现重复图片 THEN 系统 SHALL 显示消息说明未找到重复文件
5. WHEN 显示重复组 THEN 系统 SHALL 按文件路径字母顺序排列每组中的文件

### 需求 5

**用户故事：** 作为用户，我希望能够选择性地删除重复图片，以便保留我需要的文件并删除不需要的副本

#### 验收标准

1. WHEN 系统显示重复组 THEN 系统 SHALL 提供删除选项菜单
2. WHEN 用户选择删除模式 THEN 系统 SHALL 提供以下选项：保留每组第一个文件、保留每组最后一个文件、手动选择保留文件
3. WHEN 用户确认删除操作 THEN 系统 SHALL 显示将要删除的文件列表并要求最终确认
4. WHEN 用户最终确认删除 THEN 系统 SHALL 删除选定的重复文件
5. WHEN 系统删除文件 THEN 系统 SHALL 报告成功删除的文件数量和失败的文件数量

### 需求 6

**用户故事：** 作为用户，我希望删除操作是安全的，以便避免误删重要文件

#### 验收标准

1. WHEN 系统准备删除文件 THEN 系统 SHALL 要求用户明确确认删除操作
2. WHEN 用户取消删除操作 THEN 系统 SHALL 保留所有文件并返回主菜单
3. WHEN 删除操作失败 THEN 系统 SHALL 记录失败原因并继续处理其他文件
4. WHEN 系统删除文件 THEN 系统 SHALL 确保每个重复组至少保留一个文件
5. IF 文件正在被其他程序使用 THEN 系统 SHALL 跳过该文件并报告错误

### 需求 7

**用户故事：** 作为用户，我希望系统能够高效处理大量图片文件，以便在合理时间内完成扫描

#### 验收标准

1. WHEN 系统计算文件哈希 THEN 系统 SHALL 使用流式读取以优化内存使用
2. WHEN 系统处理多个文件 THEN 系统 SHALL 缓存已计算的哈希值以避免重复计算
3. WHEN 扫描大型文件夹 THEN 系统 SHALL 在 10 秒内处理至少 100 个图片文件
4. WHILE 系统处理文件 THEN 系统 SHALL 显示当前处理进度百分比

### 需求 8

**用户故事：** 作为用户，我希望系统提供友好的命令行界面，以便轻松使用各项功能

#### 验收标准

1. WHEN 系统启动 THEN 系统 SHALL 显示欢迎信息和使用说明
2. WHEN 系统显示菜单 THEN 系统 SHALL 提供清晰的选项编号和描述
3. WHEN 用户输入无效选项 THEN 系统 SHALL 显示错误提示并重新显示菜单
4. WHEN 操作完成 THEN 系统 SHALL 显示操作结果摘要
5. WHEN 用户选择退出 THEN 系统 SHALL 正常关闭程序
