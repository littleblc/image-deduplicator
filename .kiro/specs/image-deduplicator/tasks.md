# 实施计划

- [x] 1. 设置项目结构和核心接口





  - 创建 Python 包结构（src/image_deduplicator/）
  - 设置 pyproject.toml 配置文件
  - 创建核心数据模型（ImageFile, DuplicateGroup, ScanResult）
  - 配置 pytest 和 hypothesis 测试框架
  - _需求: 所有需求的基础_

- [ ]* 1.1 为数据模型编写单元测试
  - 测试 ImageFile 验证逻辑
  - 测试 DuplicateGroup 排序和属性计算
  - 测试 ScanResult 统计计算
  - _需求: 所有需求的基础_

- [x] 2. 实现文件扫描器 (FileScanner)





  - 实现递归文件夹遍历
  - 实现图片文件格式识别
  - 实现进度回调机制
  - 处理权限错误和无效路径
  - _需求: 1.2, 1.4, 2.1, 2.2, 2.3, 2.4_

- [ ]* 2.1 编写属性测试：递归扫描完整性
  - **属性 2: 递归扫描完整性**
  - **验证: 需求 1.4**

- [ ]* 2.2 编写属性测试：图片文件识别正确性
  - **属性 3: 图片文件识别正确性**
  - **验证: 需求 2.1**

- [ ]* 2.3 编写属性测试：非图片文件跳过
  - **属性 4: 非图片文件跳过**
  - **验证: 需求 2.2**

- [ ]* 2.4 编写属性测试：完整路径记录
  - **属性 5: 完整路径记录**
  - **验证: 需求 2.3**

- [ ]* 2.5 编写属性测试：文件计数准确性
  - **属性 6: 文件计数准确性**
  - **验证: 需求 2.4**

- [ ]* 2.6 为 FileScanner 编写单元测试
  - 测试空文件夹处理
  - 测试权限错误处理
  - 测试符号链接处理
  - _需求: 1.2, 1.4, 2.1, 2.2_

- [x] 3. 实现哈希计算器 (FileHasher)





  - 实现 SHA-256 哈希计算（流式读取）
  - 实现哈希缓存机制
  - 实现批量哈希计算
  - 处理文件读取错误
  - _需求: 3.1, 3.2, 3.3, 7.2_

- [ ]* 3.1 编写属性测试：哈希计算一致性
  - **属性 7: 哈希计算一致性**
  - **验证: 需求 3.1**

- [ ]* 3.2 编写属性测试：相同内容识别为重复
  - **属性 8: 相同内容识别为重复**
  - **验证: 需求 3.2, 3.3**

- [ ]* 3.3 编写属性测试：哈希缓存一致性
  - **属性 18: 哈希缓存一致性**
  - **验证: 需求 7.2**

- [ ]* 3.4 为 FileHasher 编写单元测试
  - 测试大文件处理
  - 测试文件不存在错误
  - 测试缓存命中和未命中
  - _需求: 3.1, 7.2_

- [x] 4. 实现重复检测器 (DuplicateDetector)





  - 实现按哈希值分组文件
  - 实现重复组生成
  - 实现文件路径排序
  - _需求: 3.2, 4.1, 4.5_

- [ ]* 4.1 编写属性测试：重复组完整性
  - **属性 9: 重复组完整性**
  - **验证: 需求 4.1**

- [ ]* 4.2 编写属性测试：文件路径排序
  - **属性 11: 文件路径排序**
  - **验证: 需求 4.5**

- [ ]* 4.3 为 DuplicateDetector 编写单元测试
  - 测试无重复文件情况
  - 测试单个重复组
  - 测试多个重复组
  - _需求: 3.2, 4.1_

- [x] 5. 实现文件删除器 (FileDeleter)





  - 实现删除策略枚举
  - 实现根据策略选择要删除的文件
  - 实现安全删除单个文件
  - 实现批量删除功能
  - 实现 dry-run 模式
  - 处理删除失败和文件占用错误
  - _需求: 5.2, 5.4, 5.5, 6.3, 6.4, 6.5_

- [ ]* 5.1 编写属性测试：删除操作正确性
  - **属性 13: 删除操作正确性**
  - **验证: 需求 5.4**

- [ ]* 5.2 编写属性测试：删除结果报告准确性
  - **属性 14: 删除结果报告准确性**
  - **验证: 需求 5.5**

- [ ]* 5.3 编写属性测试：重复组保留不变量
  - **属性 17: 重复组保留不变量**
  - **验证: 需求 6.4**

- [ ]* 5.4 为 FileDeleter 编写单元测试
  - 测试各种删除策略
  - 测试 dry-run 模式
  - 测试删除失败处理
  - 测试文件占用错误
  - _需求: 5.2, 5.4, 6.3, 6.5_

- [ ] 6. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 7. 实现命令行界面 (CLI)





  - 实现欢迎信息显示
  - 实现文件夹路径输入和验证
  - 实现进度显示
  - 实现重复组展示
  - 实现删除策略选择菜单
  - 实现删除确认流程
  - 实现结果摘要显示
  - 处理用户输入错误和中断信号
  - _需求: 1.1, 1.2, 1.3, 4.2, 4.3, 5.1, 5.2, 5.3, 6.1, 6.2, 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 7.1 编写属性测试：路径验证正确性
  - **属性 1: 路径验证正确性**
  - **验证: 需求 1.2**

- [ ]* 7.2 编写属性测试：重复组信息完整性
  - **属性 10: 重复组信息完整性**
  - **验证: 需求 4.2, 4.3**

- [ ]* 7.3 编写属性测试：删除确认流程
  - **属性 12: 删除确认流程**
  - **验证: 需求 5.3, 6.1**

- [ ]* 7.4 编写属性测试：取消操作安全性
  - **属性 15: 取消操作安全性**
  - **验证: 需求 6.2**

- [ ]* 7.5 编写属性测试：无效输入错误处理
  - **属性 19: 无效输入错误处理**
  - **验证: 需求 8.3**

- [ ]* 7.6 编写属性测试：操作结果摘要完整性
  - **属性 20: 操作结果摘要完整性**
  - **验证: 需求 8.4**

- [ ]* 7.7 为 CLI 编写单元测试
  - 测试菜单显示
  - 测试输入验证
  - 测试格式化输出
  - _需求: 8.1, 8.2, 8.3_

- [x] 8. 实现主程序入口 (main.py)





  - 实现主工作流协调
  - 集成所有模块
  - 实现命令行参数解析
  - 实现配置文件加载
  - 实现错误日志记录
  - _需求: 所有需求_

- [ ]* 8.1 编写端到端集成测试
  - 测试完整的扫描和删除工作流
  - 测试命令行参数
  - 测试配置文件加载
  - _需求: 所有需求_

- [x] 9. 添加可选功能增强






  - 添加 tqdm 进度条支持
  - 添加 colorama 彩色输出
  - 实现配置文件支持
  - 添加详细的帮助文档
  - _需求: 1.5, 8.1_

- [ ]* 9.1 为增强功能编写测试
  - 测试进度条显示
  - 测试配置文件解析
  - _需求: 1.5_

- [ ] 10. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
  - 运行完整的测试套件
  - 检查代码覆盖率（目标 90%+）
  - 验证所有需求都已实现
